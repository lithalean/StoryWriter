# StoryWriter Integration Configuration
version: 2.0.0
last_updated: 2025-01-08

# System Dependencies
system_frameworks:
  SwiftUI:
    version: "5.0+"
    usage: "Primary UI framework"
    critical: true
    
  Combine:
    version: "3.0+"
    usage: "Reactive data flow and state management"
    critical: true
    
  Foundation:
    version: "6.0+"
    usage: "Core system services"
    critical: true
    
  AppKit:
    platform: "macOS"
    version: "13.0+"
    usage: "macOS-specific UI components"
    critical: true
    
  UIKit:
    platform: "iOS"
    version: "16.0+"
    usage: "iOS-specific UI components"
    critical: false

# File System Integration
file_system:
  permissions:
    - read_write_user_documents
    - bookmark_access
    - sandbox_compliant
    
  supported_formats:
    input:
      - extension: ".md"
        type: "Markdown"
        handler: "TextEditor"  # MarkdownUI ready but not integrated
      - extension: ".markdown"
        type: "Markdown"
        handler: "TextEditor"
      - extension: ".txt"
        type: "Plain Text"
        handler: "TextEditor"
      - extension: ".storyproject"
        type: "Project File"
        handler: "ProjectManager"
        
    output:
      - extension: ".md"
        type: "Markdown"
        handler: "WriterDocument"
      - extension: ".txt"
        type: "Plain Text"
        handler: "WriterDocument"
      - extension: ".storyproject"
        type: "Project File"
        handler: "ProjectManager"
        
  watchers:
    external_changes:
      enabled: false
      debounce_ms: 500
      
    auto_save:
      enabled: true
      implementation: "WriterDocument"
      interval_seconds: 2  # 2-second delay timer

# Platform Integration
platform_services:
  macOS:
    menu_bar:
      enabled: true
      custom_menus: false  # Using standard menus
      
    dock:
      badge_count: false
      progress_indicator: false
      recent_documents: true  # Via UserDefaults
      
    services:
      share_menu: false  # Not implemented
      quick_look: false  # Not implemented
      spotlight: false   # Future
      
  iOS:
    share_sheet:
      enabled: false  # Not implemented
      activities: []
        
    document_browser:
      enabled: false  # Using custom FileBrowser
      
    icloud:
      enabled: false  # Future
      container: "iCloud.com.storywriter"

# External Services
external_services:
  cloud_sync:
    provider: "none"
    status: "not_implemented"
    planned_features:
      - document_sync
      - settings_sync
      - project_backup
      
  version_control:
    provider: "none"
    status: "not_implemented"
    note: "Users can version control .storyproject files externally"
      
  export_services:
    pdf:
      status: "not_implemented"
      library: "PDFKit"
      priority: "high"
      
    html:
      status: "not_implemented"
      library: "MarkdownUI renderer"
      priority: "medium"
      
    docx:
      status: "not_implemented"
      library: "Unknown"
      priority: "low"

# MarkdownUI Integration
markdown_ui:
  status: "ready_not_integrated"
  files: 97
  location: "MarkdownUI/"
  components:
    parser: "Complete"
    renderer: "Complete"
    dsl: "Complete"
    themes: "Complete"
  integration_plan:
    - "Replace TextEditor in MarkdownWriter"
    - "Configure theme system"
    - "Add syntax highlighting"
    - "Connect to WriterDocument"
  strategic_value:
    - "Reuse in SyntaxWriter project"
    - "Reuse in LocalLLM project"
    - "Consider XCFramework packaging"

# Database Integration
database:
  current: "JSON files"
  storage_location: "~/Documents/StoryWriter Projects"
  format: "Pretty-printed JSON"
  
  swiftdata:
    status: "scaffolded_unused"
    model: "Item.swift"
    plan: "Future migration from JSON"
    
  future_models:
    character_database:
      status: "ui_only"
      needs: "Data model implementation"
    index_cards:
      status: "ui_only"  
      needs: "CRUD operations"
    timeline:
      status: "not_implemented"
      needs: "Complete feature"

# Network Integration
network:
  current_usage: "none"
  offline_first: true
  
  future_features:
    collaboration:
      protocol: "WebSocket"
      status: "not_planned"
      
    cloud_backup:
      protocol: "HTTPS"
      status: "considered"
      
    plugin_repository:
      protocol: "HTTPS"
      status: "not_planned"

# Security & Privacy
security:
  sandboxing:
    enabled: true
    entitlements:
      - "com.apple.security.files.user-selected.read-write"
      - "com.apple.security.files.bookmarks.app-scope"
      
  encryption:
    at_rest: false  # Relies on FileVault
    in_transit: "n/a"  # No network features
    
  privacy:
    analytics: false
    crash_reporting: false
    user_data_collection: false

# Build & Distribution
distribution:
  app_store:
    ready: false
    blockers:
      - "Save UI implementation"
      - "File browser consolidation"
      - "MarkdownUI integration"
      - "Undo/redo system"
      - "App icon"
      
  direct_distribution:
    ready: false
    format: ".app bundle"
    signing: "Development"
    blockers:
      - "Critical features missing"
    
  testflight:
    ready: false
    requirements:
      - "Apple Developer Account"
      - "App Store Connect setup"
      - "Feature completion"

# StoryMapper Integration
story_mapper:
  status: "separated_application"
  relationship: "Independent sibling app"
  shared_format: ".storyproject (without node data)"
  removed_components:
    - "16 mapper-related files"
    - "Node system"
    - "Canvas visualization"
    - "Edge connections"
  future_integration:
    - "Potential plugin architecture"
    - "Shared project format"
    - "Inter-app communication"

# Performance Monitoring
monitoring:
  metrics:
    tracked: false
    current_focus:
      - text_editing_performance
      - panel_switching_speed
      - file_operations
    planned:
      - launch_time
      - document_load_time
      - markdown_render_time
      - memory_usage
      
  crash_reporting:
    enabled: false
    service: "none"
    
  logging:
    level: "debug"
    destination: "console"

# Dependency Management
package_management:
  type: "Swift Package Manager"
  packages: []  # No external packages
  internal_libraries:
    MarkdownUI:
      status: "included_not_integrated"
      files: 97
      size: "~2MB"

# Accessibility APIs
accessibility:
  voiceover:
    supported: "partial"
    tested: false
    
  keyboard_navigation:
    full_support: false
    implemented:
      - "Basic tab navigation"
    missing:
      - "Complete keyboard shortcuts"
      - "Command palette"
    
  dynamic_type:
    supported: true
    font_range: "11-24pt"
    
  reduced_motion:
    respected: true

# Testing Integration
testing:
  unit_tests:
    framework: "XCTest"
    coverage: 0
    priority_areas:
      - "WriterState bounds"
      - "WriterDocument save/load"
      - "Config behaviors"
    
  ui_tests:
    framework: "XCTest"
    coverage: 0
    priority_areas:
      - "Panel switching"
      - "Font size controls"
      - "File browser"
    
  integration_tests:
    framework: "XCTest"
    coverage: 0
    
  continuous_integration:
    service: "none"
    planned: "GitHub Actions"

# Localization
localization:
  supported_languages:
    - en  # English only
    
  planned_languages: []  # No immediate plans
    
  localization_framework: "Foundation"
  
# Feature Flags
feature_flags:
  development:
    debug_menu: true
    verbose_logging: true
    show_fps: false
    
  production:
    debug_menu: false
    verbose_logging: false
    
  experimental:
    markdown_ui_integration: false  # Ready but not active
    swiftdata_migration: false
    export_functionality: false

# Known Issues
known_issues:
  critical:
    - "No save UI trigger in toolbar"
    - "File browser can't open files"
    - "Three redundant file browser implementations"
    
  major:
    - "MarkdownUI not integrated (97 files unused)"
    - "Character/Index panels have no persistence"
    - "No undo/redo system"
    
  minor:
    - "Location directory still present (should be removed)"
    - "Timeline directory empty"
    - "Outline panel placeholder only"

# File Browser Consolidation
file_browser_status:
  implementations:
    FileBrowser:
      location: "Core/FileBrowser.swift"
      status: "active"
      functionality: "50% - browse only"
      
    FileSystem:
      location: "Core/FileSystem.swift"
      status: "unclear"
      functionality: "unknown"
      
    FileSystemModel:
      location: "Core/FileSystemModel.swift"
      status: "unclear"
      functionality: "unknown"
      
  consolidation_plan:
    - "Evaluate which implementation to keep"
    - "Remove redundant implementations"
    - "Connect to WriterDocument"
    - "Add file opening capability"